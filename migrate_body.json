{
    "query": "CREATE OR REPLACE FUNCTION send_whatsapp(p_content TEXT, p_number TEXT, p_media_url TEXT DEFAULT NULL) RETURNS JSONB LANGUAGE plpgsql SECURITY DEFINER AS $$ DECLARE request_id BIGINT; BEGIN SELECT net.http_post( url := 'https://app.builderbot.cloud/api/v2/c3fd918b-b736-40dc-a841-cbb73d3b2a8d/messages', headers := jsonb_build_object('Content-Type', 'application/json', 'x-api-builderbot', 'bb-3c45fa69-2776-4275-82b6-2d6df9e08ec6'), body := jsonb_build_object('messages', CASE WHEN p_media_url IS NOT NULL THEN jsonb_build_object('content', p_content, 'mediaUrl', p_media_url) ELSE jsonb_build_object('content', p_content) END, 'number', p_number, 'checkIfExists', false) ) INTO request_id; RETURN jsonb_build_object('success', true, 'request_id', request_id); EXCEPTION WHEN OTHERS THEN RETURN jsonb_build_object('success', false, 'error', SQLERRM); END; $$;"
}