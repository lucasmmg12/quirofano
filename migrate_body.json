{"query":"-- ============================================================\n-- Alta de usuarios iniciales + funci칩n cambio de contrase침a\n-- Fecha: 2026-02-24\n-- ============================================================\n\n-- Funci칩n para cambiar contrase침a\nCREATE OR REPLACE FUNCTION change_password(\n  p_user_id UUID,\n  p_old_password TEXT,\n  p_new_password TEXT\n) RETURNS BOOLEAN AS $$\nDECLARE\n  v_valid BOOLEAN;\nBEGIN\n  -- Verificar password actual\n  SELECT EXISTS(\n    SELECT 1 FROM usuarios\n    WHERE id = p_user_id\n      AND password_hash = crypt(p_old_password, password_hash)\n  ) INTO v_valid;\n\n  IF NOT v_valid THEN\n    RETURN FALSE;\n  END IF;\n\n  -- Actualizar password\n  UPDATE usuarios\n  SET password_hash = crypt(p_new_password, gen_salt('bf')),\n      updated_at = NOW()\n  WHERE id = p_user_id;\n\n  RETURN TRUE;\nEND;\n$$ LANGUAGE plpgsql SECURITY DEFINER;\n\n-- Alta de usuarios (password: 123456 para todos)\nSELECT create_user('frojo', 'F. Rojo', '123456', 'FR');\nSELECT create_user('amedawar', 'A. Medawar', '123456', 'AM');\nSELECT create_user('gacosta', 'G. Acosta', '123456', 'GA');\nSELECT create_user('vfigueroa', 'V. Figueroa', '123456', 'VF');\nSELECT create_user('mmoreno', 'M. Moreno', '123456', 'MM');\nSELECT create_user('gcortez', 'G. Cortez', '123456', 'GC');\nSELECT create_user('lsoto', 'L. Soto', '123456', 'LS');\nSELECT create_user('ctorres', 'C. Torres', '123456', 'CT');\nSELECT create_user('malvarado', 'M. Alvarado', '123456', 'MA');\n"}